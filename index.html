
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>GeoAR.js demo</title>
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
    <script src="./aframe-ar-nft.js"></script>
    <style>
        #search{
            width: 100%;
            height: 100%;
            position: relative;
            text-align: center;
            font-size: 18px;
        }
        #search-button{
            position: absolute;
            bottom: 30px;
            width: 50px;
            height: 30px;
            background-color: blue;
            color: #fff;
            display: none;
        }
        #search-text{
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%,-50%);
            display: none;
            color: aqua;
        }
        video {
            mix-blend-mode: screen;
        }
    </style>
    <script>
        window.onload = function() {
            AFRAME.registerComponent('videohandler', {
                init: function () {
                    var marker = this.el;
    
                    this.vid = document.querySelector("#vid");
    
                    marker.addEventListener('markerFound', function () {
                        this.vid.play();
                        document.querySelector("#search-text").style.display = 'block';
                        document.querySelector("#search-button").style.display = 'block';
                    }.bind(this));
    
            marker.addEventListener('markerLost', function() {
                this.vid.pause();
                this.vid.currentTime = 0;
            }.bind(this));
                }
            });
        };
        window.addEventListener("arjs-nft-loaded", (event) => {
         console.log(1);
        });
    </script>
</head>

<body style='margin : 0px; overflow: hidden;'>
    <div id="search">
        <p id="search-text">寻景成功！（+1 探索点)</p>
        <button id="search-button"></button>
    </div>
    <a-scene
    vr-mode-ui="enabled: false;"
    renderer="logarithmicDepthBuffer: true;"
    embedded
    arjs="trackingMethod: best; sourceType: webcam;debugUIEnabled: false;">
        <a-assets>
            <video id="vid" src="https://deeplor.oss-cn-hangzhou.aliyuncs.com/AR/output(compress-video-online.com)%20(1).mp4" preload="auto" response-type="arraybuffer" loop
                crossorigin webkit-playsinline autoplay muted playsinline>
            </video>
        </a-assets>

        <a-nft
            emitevents="true"
            videohandler
            type='nft' url='./dataNFT/trees'
            smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5"
        >
            <a-video
                src="#vid"
                rotation='90 0 180'
                width="140"
                height="220"
                position="140 -50 -200"
                transparent="true"
                >
            </a-video>
        </a-nft>
		<a-entity camera position="0 0 5" />
	</a-scene>
</body>
</html>
